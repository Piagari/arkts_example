/**
 * æˆ‘çš„é¡µé¢
 */
import { AppCard } from '../components/AppCard';
import { AppColors } from '../theme/AppColors';
import { AppDimensions } from '../theme/AppDimensions';
import { AppTypography } from '../theme/AppTypography';
import { mockUser, mockOrderCount, mockFootprints } from '../data/MockData';
import { User, OrderCount, Footprint } from '../models/CommonModels';

@Component
export struct MePage {
  @State user: User = mockUser;
  @State orderCount: OrderCount = mockOrderCount;
  @State footprints: Footprint[] = mockFootprints;
  @State isLoggedIn: boolean = false;

  build() {
    Column() {
      Scroll() {
        Column({ space: AppDimensions.spaceMedium }) {
          // ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ
          this.UserInfoSection()

          // ä¼šå‘˜æƒç›Šå¡ç‰‡
          this.MembershipCard()

          // è®¢å•ç®¡ç†
          this.OrderSection()

          // æˆ‘çš„è¶³è¿¹
          if (this.footprints.length > 0) {
            this.FootprintSection()
          }

          // åŠŸèƒ½èœå•
          this.FunctionMenu()
        }
        .padding(AppDimensions.paddingMedium)
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(AppColors.background)
  }

  // ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ
  @Builder
  UserInfoSection() {
    Row({ space: AppDimensions.spaceLarge }) {
      // å¤´åƒ
      Text('ğŸ‘¤')
        .fontSize(48)
        .width(72)
        .height(72)
        .borderRadius(AppDimensions.radiusRound)
        .backgroundColor(AppColors.surfaceVariant)
        .textAlign(TextAlign.Center)
        .padding({ top: 12 })

      // ç”¨æˆ·ä¿¡æ¯
      Column({ space: AppDimensions.spaceXSmall }) {
        Text(this.isLoggedIn ? this.user.nickName : 'æœªç™»å½•')
          .fontSize(AppTypography.fontSizeXLarge)
          .fontColor(AppColors.textPrimary)
          .fontWeight(AppTypography.fontWeightBold)

        Text(this.isLoggedIn && this.user.phone ? `æ‰‹æœºå·: ${this.user.phone}` : 'ç‚¹å‡»ç™»å½•')
          .fontSize(AppTypography.fontSizeMedium)
          .fontColor(AppColors.textSecondary)
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)

      // ç®­å¤´
      Text('â€º')
        .fontSize(24)
        .fontColor(AppColors.textTertiary)
    }
    .width('100%')
    .padding(AppDimensions.paddingLarge)
  }

  // ä¼šå‘˜æƒç›Šå¡ç‰‡
  @Builder
  MembershipCard() {
    Row({ space: AppDimensions.spaceMedium }) {
      Row({ space: AppDimensions.spaceSmall }) {
        Text('ğŸ‘‘')
          .fontSize(18)

        Text('5 VIP Benefits!')
          .fontSize(AppTypography.fontSizeMedium)
          .fontColor(AppColors.vip)
          .fontWeight(AppTypography.fontWeightBold)
      }

      Blank()

      Text('æ¿€æ´»ä¼šå‘˜')
        .fontSize(AppTypography.fontSizeMedium)
        .fontColor(AppColors.vip)
        .padding({
          left: AppDimensions.paddingMedium,
          right: AppDimensions.paddingMedium,
          top: 6,
          bottom: 6
        })
        .border({
          width: 1,
          color: AppColors.vip,
          radius: AppDimensions.radiusLarge
        })
    }
    .width('100%')
    .padding(AppDimensions.paddingLarge)
    .backgroundColor(AppColors.vipBackground)
    .borderRadius(AppDimensions.radiusMedium)
  }

  // è®¢å•ç®¡ç†
  @Builder
  OrderSection() {
    Column() {
      Column({ space: AppDimensions.spaceMedium }) {
        // æ ‡é¢˜è¡Œ
        Row() {
          Row({ space: AppDimensions.spaceSmall }) {
            Text('ğŸ“‹')
              .fontSize(18)

            Text('æˆ‘çš„è®¢å•')
              .fontSize(AppTypography.fontSizeLarge)
              .fontWeight(AppTypography.fontWeightMedium)
              .fontColor(AppColors.textPrimary)
          }

          Blank()

          Row({ space: AppDimensions.spaceXSmall }) {
            Text('æŸ¥çœ‹å…¨éƒ¨')
              .fontSize(AppTypography.fontSizeMedium)
              .fontColor(AppColors.textSecondary)

            Text('â€º')
              .fontSize(20)
              .fontColor(AppColors.textTertiary)
          }
        }
        .width('100%')

        // è®¢å•çŠ¶æ€å›¾æ ‡
        Row() {
          this.OrderStatusItem('å¾…ä»˜æ¬¾', 'ğŸ’³', this.orderCount.pendingPayment)
          this.OrderStatusItem('å¾…å‘è´§', 'ğŸ“¦', this.orderCount.pendingShipment)
          this.OrderStatusItem('å¾…æ”¶è´§', 'ğŸšš', this.orderCount.pendingReceive)
          this.OrderStatusItem('å¾…è¯„ä»·', 'ğŸ’¬', this.orderCount.pendingReview)
          this.OrderStatusItem('é€€æ¬¾/å”®å', 'â†©ï¸', this.orderCount.refunding + this.orderCount.refunded)
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceAround)
      }
    }
    .width('100%')
    .backgroundColor(AppColors.surface)
    .borderRadius(AppDimensions.radiusMedium)
    .padding(AppDimensions.paddingLarge)
  }

  // è®¢å•çŠ¶æ€é¡¹
  @Builder
  OrderStatusItem(label: string, icon: string, count: number) {
    Column({ space: AppDimensions.spaceSmall }) {
      Stack({ alignContent: Alignment.TopEnd }) {
        Text(icon)
          .fontSize(24)

        if (count > 0) {
          Text(count > 99 ? '99+' : count.toString())
            .fontSize(10)
            .fontColor(AppColors.onPrimary)
            .backgroundColor(AppColors.error)
            .borderRadius(AppDimensions.radiusRound)
            .padding({ left: 4, right: 4, top: 1, bottom: 1 })
            .position({ x: 12, y: -6 })
        }
      }
      .width(24)
      .height(24)

      Text(label)
        .fontSize(AppTypography.fontSizeSmall)
        .fontColor(AppColors.textPrimary)
    }
  }

  // æˆ‘çš„è¶³è¿¹
  @Builder
  FootprintSection() {
    Column() {
      Column({ space: AppDimensions.spaceMedium }) {
        // æ ‡é¢˜è¡Œ
        Row() {
          Row({ space: AppDimensions.spaceSmall }) {
            Text('ğŸ‘£')
              .fontSize(18)

            Text('æˆ‘çš„è¶³è¿¹')
              .fontSize(AppTypography.fontSizeLarge)
              .fontWeight(AppTypography.fontWeightMedium)
              .fontColor(AppColors.textPrimary)
          }

          Blank()

          Row({ space: AppDimensions.spaceXSmall }) {
            Text('æŸ¥çœ‹å…¨éƒ¨')
              .fontSize(AppTypography.fontSizeMedium)
              .fontColor(AppColors.textSecondary)

            Text('â€º')
              .fontSize(20)
              .fontColor(AppColors.textTertiary)
          }
        }
        .width('100%')

        // è¶³è¿¹åˆ—è¡¨
        List({ space: AppDimensions.spaceMedium }) {
          ForEach(this.footprints, (footprint: Footprint) => {
            ListItem() {
              Image(footprint.goodsMainPic)
                .width(100)
                .height(100)
                .borderRadius(AppDimensions.radiusSmall)
                .objectFit(ImageFit.Cover)
            }
          })
        }
        .listDirection(Axis.Horizontal)
        .scrollBar(BarState.Off)
        .width('100%')
        .height(100)
      }
    }
    .width('100%')
    .backgroundColor(AppColors.surface)
    .borderRadius(AppDimensions.radiusMedium)
    .padding(AppDimensions.paddingLarge)
  }

  // åŠŸèƒ½èœå•
  @Builder
  FunctionMenu() {
    Column() {
      Column() {
        this.MenuItem('ä¼˜æƒ åˆ¸', 'ğŸ«', '#6A9BE6')
        Divider().color(AppColors.divider)
        this.MenuItem('æ”¶è´§åœ°å€', 'ğŸ“', '#66BB6A')
        Divider().color(AppColors.divider)
        this.MenuItem('åœ¨çº¿å®¢æœ', 'ğŸ‘¨â€ğŸ’¼', '#F87C7B')
        Divider().color(AppColors.divider)
        this.MenuItem('æ„è§åé¦ˆ', 'âœï¸', '#F3AF76')
        Divider().color(AppColors.divider)
        this.MenuItem('å…³äºæˆ‘ä»¬', 'â„¹ï¸', '#9179F1', false)
      }
    }
    .width('100%')
    .backgroundColor(AppColors.surface)
    .borderRadius(AppDimensions.radiusMedium)
    .padding(AppDimensions.paddingLarge)

    Column() {
      this.MenuItem('è®¾ç½®', 'âš™ï¸', '#26A69A', false)
    }
    .width('100%')
    .backgroundColor(AppColors.surface)
    .borderRadius(AppDimensions.radiusMedium)
    .padding(AppDimensions.paddingLarge)
    .margin({ top: AppDimensions.spaceMedium })
  }

  // èœå•é¡¹
  @Builder
  MenuItem(title: string, icon: string, iconColor: string, showDivider: boolean = true) {
    Row({ space: AppDimensions.spaceMedium }) {
      Text(icon)
        .fontSize(20)

      Text(title)
        .fontSize(AppTypography.fontSizeMedium)
        .fontColor(AppColors.textPrimary)
        .layoutWeight(1)

      Text('â€º')
        .fontSize(20)
        .fontColor(AppColors.textTertiary)
    }
    .width('100%')
    .padding({
      top: AppDimensions.paddingLarge,
      bottom: AppDimensions.paddingLarge
    })
  }
}

